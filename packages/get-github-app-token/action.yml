name: GitHub App Token
author: "AB innovision UG"
description: ""

inputs:
  name:
    description: Name of the GitHub App to get the token for.
    required: true
outputs:
  access_token:
    description: ""
    value: ${{ steps.auth.outputs.access_token }}
runs:
  using: composite
  steps:
    - id: prepare
      name: "Prepare"
      shell: bash
      run: |
        ID_DECODED=$(echo "${{ inputs.id }}" | base64 --decode)
        echo "GCP_SERVICE_ACCOUNT=$(echo "$ID_DECODED" | jq -cr ".serviceAccount")" >> $GITHUB_ENV
        echo "GCP_WORKLOAD_IDENTITY_PROVIDER=$(echo "$ID_DECODED" | jq -cr ".workloadIdentityProvider")" >> $GITHUB_ENV
    - id: auth
      name: "Authenticate"
      uses: google-github-actions/auth@v1
      with:
        workload_identity_provider: ${{ env.GCP_WORKLOAD_IDENTITY_PROVIDER }}
        service_account: ${{ env.GCP_SERVICE_ACCOUNT }}
        token_format: ${{ inputs.token_format }}
